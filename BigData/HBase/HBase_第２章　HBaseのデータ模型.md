# HBase-分散型大規模非関係データベース -2

## 第２章　HBaseのデータ模型

**基本概念**

NameSpace（命名空間）：データベースのdatabase概念に似ており、各命名空間には複数のテーブルが存在する。HBaseにはhbaseとdefaultという2つの命名空間があり、hbaseにはHBaseの内蔵テーブル、defaultには黙認の状況でデータがこの命名空間に格納される。テーブルは命名空間の有無を選択でき、テーブルの作成時に命名空間を追加する場合、テーブル名はNamespace:Tableで区切られる。

Table：関係型データベースのテーブルの概念に似ているが、異なる点は、HBaseでは列族のみを指定すればよく、具体のテーブル属性などは全て列族内に設定されて、具体的な列を設定する必要はないということです。

Row：HBaseのテーブル内の各行は、RowKeyと複数の列で構成され、これらの列は列族によって分類される。HBaseデータベースには、行というの言い方があるが、ただ理解する為に理論の上に設定されるの概念で、実際の格納には関係データベースように一層一層で行を重ねる形式ではない。

RowKey（行キー）：RowKeyはユーザーが指定した重複しない文字列で構成され、行の唯一の識別子です。データはRowKeyの文字列の順序に保存され、RowKeyを索引として検索できるため、RowKeyの設計は非常に重要です。

Column Family（列族）：列族は複数の列の集合です。列族は動的に柔軟に複数の列を定義できる。表の関連する属性は殆ど列族で設置され、同じ表内の異なる列族は完全に異なる属性設定を持つことができまるが、同じ列族内の全ての列は同じ属性を持つ。列族の存在の意味は、類似の内容である列が同じ列族に分類され、HBaseができるだけ列族を同じサーバーに配置しようと検索効率的になるためです。

Column Qualifier（列）：HBaseの列は任意に定義でき、行内の列の名前や数は制約されない、唯一の制限は列が列族内に存在することに依存する。列の名前は、その所属する列族を前に付ける必要がある。例えば、info:name、info:age。

version（バージョン）：データの異なるバージョンを識別するために使用される。タイムスタンプ（timestamp）は黙認に指定されるが、ユーザーが明示的に指定することもできる。データを読み取る際、バージョン番号は省略でき、指定しない場合、HBaseは最高のバージョンのデータを取得する。

Cell（セル）：1つの列には複数のバージョンのデータを格納できる。そして、その中に一つのバージョンをセル（Cell）と呼ばれる。

Region（区域）：Regionの概念は、関係型データベースの分区や断片に類似している。暫くRegionは複数の行で構成されると理解できる。Region内では行の順序はRowkeyの文字列大小に並べる。データ量が多い場合、HBaseは新しいRegionを分割することがある。

**データ論理仕組み**

![image-20231129161648800](D:\OneDrive\picture\Typora\image-20231129161648800.png)

　　それはHBaseのデータ仕組みの論理的な図示、図から見えて多種の仕組みで合わせて使い、単一の列又は行ではない。その様な混合の仕組みがビッグデータ処理には中々必要です。

- 先ず一つの列族が複数の列が含まれ、同一の列族にの列が同じ属性があり、HBaseの最適化や格納の規格が列族の級別によって運行し、そのためHBaseができるだけ一つの列族を同一のサーバーに格納してある。従って、最初列を作成する際に類似の列が一つの列族に入れると考えるはずです。後は、公式サイトで一枚テーブルが列族数量が３つを越さないとお勧めです。
- テーブルがRowKeyを基準として一つ一つのRegion（区域）に分割されている。実際の状況は列族と合わせて全体のデータが塊に割られてある。データ量の大小から並べて、列データが列族に分割され、列族また区域に分割されると「列ー＞列族ー＞区域」みたい順序です。ただ、データを訪問する時の順序がちょうど逆です。先ずどっちの区域を確定し、次対応の列族、最後に列データにRowKeyを基づいてある具体的なデータを見つける。「区域ー＞列族ー＞列」のような検索の流れである。

![image-20231201070026786](D:\OneDrive\picture\Typora\image-20231201070026786.png)

- RowKeyは全局の唯一の索引、列族毎に存在してあり、その除いて索引の添加ができない。他の定位でき標識はデータのバージョン、同一のデータの不同のバージョンが一緒に格納されている。論理仕組み図示が表現しがたい、次の物理ストレージ仕組みに説明する。

**物理ストレージ仕組み**

![image-20231204070211023](D:\OneDrive\picture\Typora\image-20231204070211023.png)

- 図示から見えて、HBaseデータの実際のストレージ仕組みは列族や区域が構成したのストレージファイルにkey-value形式で格納され、単一の行でも列でもない結構です。一つのストレージファイルは一つの列族や唯一の区域に対応して、データの分割を通して全部テーブルのデータを検索することが避ける。
- HBaseが不同のバージョンのデータが同時に存在でき、さえ旧バージョンに対して、改修、消除など操作類型（Type）も記載された。
- HBaseは空い値（null）が空間を占めることがない。具体的な原理が後の章節が紹介しておく。