# 分散型協調サービスフレームワーク -- Zookeeper-3

## 第３章　Zookeeperのデータ結構と監聴機能

### 第１節　Zookeeperのデータる構

　　ZooKeeperでは、データ情報は個々のデータ節点（node）に保存され、これらの節点はZNodeと呼ばれる。ZNodeはZooKeeper内での最小のデータ単位であり、ZNodeの下にまだznodeを配置し続ける。こないうにして階層構造を形成されるの命名空間がZNode Treeと呼ばれる。ZNode Treeは、伝統のファイルシステムに似た階層の木構造を使用して管理される。

![image-20231011152002194](C:\Users\Izaya\AppData\Roaming\Typora\typora-user-images\image-20231011152002194.png)

　　ZooKeeper中に、毎データ節点がZNodeだと言われる、例えば、根目録（root directory）の下には2つの節点があり、それぞれふが「/app1」と「app2」です。「app1」の下には更に3つの子節点がある。全てのZNodeは階層的に構成され、このような木構造が形成された。ZNodeの節点経路（path）は、Linuxファイルシステムの経路と非常に似ており、斜線（/）で区切られたで表してくる。開発者はこの節点にデータを書き込んだり、節点の下にサ子節点を作成したりすることができる。

### 第２節　 ZNodeの類型

　　まず、ZooKeeperのznode treeがデータ節点から成り立っていることを理解した。次に、節点について詳しく説明しよう。ZooKeeperの節点は主に3つの類型に分類される：

- **持続性節点（Persistent）**：これはZooKeeperで最も一般的な節点類型で、節点が作成された後、サーバー上に永続的に存在し、削除操作が実行されるまで保留してある。

- **臨時節点（Ephemeral）**: 臨時節点は自動的に削除される節点で、クライアント会話と結びついています。クライアント会話が終了すると、ノードは削除される。臨時節点は子節点を作成できない。

- **順序節点（Sequential）**: 順序節点は、節点名の後ろに数字の接尾辞を付けて作成される節点です。これにより、節点が作成された順序が保持される。

　　ZooKeeperのトランザクションには、ZooKeeperサーバーの状態を変更する操作を指し、データ更新など操作だけではない、節点の作成、削除、内容の更新なども含む。各トランザクション請求には、唯一のグローバルなトランザクションID（ZXID）が割り当てられ、通常は64ビットの数字で表される。各ZXIDは一回の更新操作を示し、これらのZXIDからZooKeeperが更新操作請求を処理した順序を識別することができる。