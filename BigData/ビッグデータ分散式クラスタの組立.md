# ビッグデータ分散式クラスタの組立

### 第１節　仮想マシンのインストール

　　VMwareの選びは普通の完全版を使用していい。VMwareのインストールはネット上に色々説明がり、次の仮想マシンのインストールを紹介してから直接に始める。

- カスタマイズ選択肢を選ぶ

![image-20240126113207134](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126113207134.png)

![Screenshot 2024-01-26 114229](D:\OneDrive\picture\Typora\BigData\Preparatory Work\Screenshot 2024-01-26 114229-1706238162112-5.png)

- Workstation 15.x互換性の選択肢

![Screenshot 2024-01-26 114229](D:\OneDrive\picture\Typora\BigData\Preparatory Work\Screenshot 2024-01-26 114229-1706238275897-7.png)

- 仮想マシンを作成した後でLinuxインストール

![Screenshot 2024-01-26 114229](D:\OneDrive\picture\Typora\BigData\Preparatory Work\Screenshot 2024-01-26 114229-1706238733806-9.png)

![Screenshot](D:\OneDrive\picture\Typora\BigData\Preparatory Work\Screenshot.png)

- 仮想マシンを格納する目録

![image-20240126140039914](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140039914.png)

- 実際の状況に応じて変数を設定できるけれど、ビッグデータには高いプロセッサ性能が必要ため、できるだけ十分の資源を分配してあげる。特別ストレージ大小には20Gを勧めです。

![image-20240126140232359](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140232359.png)

![image-20240126140308237](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140308237.png)

- 黙認のままで「Next」を押す

![image-20240126140327310](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140327310.png)

![image-20240126140344591](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140344591.png)

![image-20240126140402517](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140402517.png)

![image-20240126140452789](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140452789.png)

- 20GBお勧めて、空間が足りないなら、事後追加するのがなかなか手がかかてある。

![image-20240126140530503](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140530503.png)

![image-20240126140551235](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140551235.png)

![image-20240126140609099](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140609099.png)

- ここで仮想マシンの作成が終わった

![image-20240126140637505](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140637505.png)

### 第２節　CentosOSのマウント

　　Linux01仮想マシンの設定画面に入って、イメージファイルを選択する。OSのバージョンは「CentOS-7-x86_64-DVD-1810.iso」を選択し、互換性を考えて、Hadoop、HBase、Zoookeeperなどソフトウェアがそのバージョンにインストールするのが問題ないと確認した。できるだけこのバージョンを使用して、不明のエラーを避けられる。

ダウンロード：https://ftp.iij.ad.jp/pub/linux/centos-vault/7.6.1810/isos/x86_64/

![Screenshot](D:\OneDrive\picture\Typora\BigData\Preparatory Work\Screenshot-1706249684445-16.png)

- Liunⅹ01仮想マシンを起動し、第二の図で表れて「Install CentOS 7」を選択して入って、Centosのインストールを始める。

![image-20240126161602300](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126161602300.png)

![Screenshot](D:\OneDrive\picture\Typora\BigData\Preparatory Work\Screenshot-1706253527058-18.png)

![image-20240126162719940](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126162719940.png)

![image-20240126163035295](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126163035295.png)

- 自らの情況に応じて選択

![image-20240126163323888](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126163323888.png)

-  INSTALLATION DESTINATIONに入って

![image-20240126163350640](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126163350640.png)

- 自分で手動的にディスクを分配すると選択し、「Done」を押して次のディスク設定画面に遷移する

![image-20240126163536581](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126163536581.png)

![image-20240126163610725](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126163610725.png)

- 図にそってディスク仕切りを添加する。三つ部分で組み合い、根目録「/」にbootやswapを除いて残りの全て空間を分配して、特にストレージ大小を入力のが必要ないです。

![image-20240126163730584](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126163730584.png)

![image-20240126163828529](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126163828529.png)

![image-20240126163911593](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126163911593.png)

![image-20240126163952649](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126163952649.png)

- 図のように完成したら「Done」を押して変更一覧が表れる。「Accept Changes」ボタンを押す。

![image-20240126164014412](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126164014412.png)

![image-20240126164419211](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126164419211.png)

- OSのインストールを始める。

![image-20240126164459202](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126164459202.png)

- rootのパスワードを設定。

![image-20240126164614295](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126164614295.png)

![image-20240126164543421](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126164543421.png)

- rootユーザーを使用のが十分で、他の新ユーザーを作成しない。後は、若しboot分配大小が足りない、このインストール画面に限りで進められないという問題に遭ってある。

![image-20240126164811702](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126164811702.png)

- 「Reboot」ボタンを押して、OSを起動する流れに入っている。

![image-20240126165010923](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126165010923.png)

![image-20240126165150048](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126165150048.png)

![image-20240126165110305](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126165110305.png)

- rootユーザー名やパスワードを入力してOSシステムに入る。

![image-20240126165221456](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126165221456.png)

- 全て問題ないなら、ここでCentosOSのインストールが全部終わった。

![image-20240126165346427](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126165346427.png)

### 第３節　OSの環境整備

#### ネットワーク配置

　　その前にVMwareのネットワーク設定を確認しておき、仮想マシンに勝手にIPアドレスを書き込むのが駄目です。

![image-20240130160644778](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240130160644778.png)

- 特別の変更点がない

![image-20240130161154110](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240130161154110.png)

- IPアドレスはGateway IP前の6位の値「192.168. 31」と一致にしなければならない。

![image-20240130161732554](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240130161732554.png)

- 最後の3位の数値は「128~254」範囲内に指定する。

![image-20240130161955350](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240130161955350.png)

**固定IPアドレス設定**

　　OSシステムに入って、今は外部からネットに連接できない。「ip addr」命令を入力して、IPアドレスに関する情報が欠けることが見える。従って、当面の任務は手動でシステム配置ファイルを改修し、正常にネットが通じることを動かしてある。

![image-20240201152647957](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201152647957.png)

　　VI編集工具を使って「ifcfg-ens33」ファイルを開く。VIの使用紹介はここで略する。

```
vi /etc/sysconfig/network-scripts/ifcfg-ens33
```

　　以下のように自分のネットワーク変数に即して改修を行う。

```
#改修の部分
BOOTPROTO=static
ONBOOT=yes
#添加の部分
#最後の三つ変数がVMwareネットワーク配置に一致を確保
IPADDR=192.168.31.135
NETMASK=255.255.255.0
GATEWAY=192.168.31.2
DNS1=192.168.31.2
```

![image-20240201142648288](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201142648288.png)

```
#ネットワークを再起動
service network restart

#ネットワークが通じるかどうか検査
ping yahoo.com
```

![image-20240201143410298](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201143410298.png)

　　改めてネットワーク設定を示して、新しいIPアドレス情報が書き込んだ。

![image-20240201142836164](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201142836164.png)

#### 基本環境設定

　　ネットワークを設定してIPアドレスを決めてから、外部からOSシステムに通信することができる。ここでSecureCRT工具を選んで、VMwareに代わってOSに訪問しておく。リモート訪問、ファイル転送、コーヒーなど操作がSecureCRTに中々便利である。以下はSecureCRTで登録の流れを表す。

![image-20240201191706532](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201191706532.png)

![image-20240201191737065](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201191737065.png)

![image-20240201191752496](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201191752496.png)

![image-20240201191822133](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201191822133.png)

![image-20240201192214227](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201192214227.png)

![image-20240201192234537](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201192234537.png)

- 幾つか工具をインストール


```
#vim編集器
yum install vim

#アップロード工具
yum -y install lrzsz
```

![image-20240202070539835](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202070539835.png)

![image-20240202163237986](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202163237986.png)

```
yum -y install lrzsz
```

**firewall/selinux停止**

　　ビッグデータシステムは、一般的に企業内部に使用するものが存在し、専門的に外部訪問できるサービスを備えて一定の安全措置がある限り、クラスタ間に通信の安全性を考えることが少ない、必要ないエラーを避けるはずです。

```
#firewall停止
systemctl stop firewalld

#システムの起動時にfirewalldが自動的に起動しないようにする
systemctl disable firewalld

#firewall状態を検査
systemctl status firewalld
```

![image-20240202090106400](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202090106400.png)

```
#selinux配置ファイルにはいって
vim /etc/selinux/config

#「SELINUX=enforcing」を註釈になって、「SELINUX=disabled」を追加
SELINUX=disabled
```

![image-20240202102831883](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202102831883.png)

**仮想マシン名称やhostname**

　　その部分目的は仮想マシン名称、hostname、IPアドレスを統一になる。一つの明らかな名称をあげてどのサービスを直ぐに確定できる。

- 仮想マシン名称の改修

![image-20240214201252515](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240214201252515.png)

- hostname改修

```
vim /etc/sysconfig/network

#以下内容を添加
NETWORKING=yes
hostname=centos1

#ネットワークを再起動
service network restart
```

![image-20240214201318651](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240214201318651.png)

- hostnameやIPアドレスのマッピング添加

```
vim /etc/hosts

#以下の内容ように添加し、再起動は必要ない
192.168.31.135 centos1
192.168.31.136 centos2
192.168.31.137 centos3
192.168.31.138 centos4
```

![image-20240214201343191](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240214201343191.png)

**JDKインストール**

　　ビッグデータはJavaの基準パッケージを引用することがあり、特別Hadoopシステムが元にJava言語で構成され、つまり、JDKが必ず備えておくものです。

JAVA8のダウンロードURL：[Java Archive Downloads - Java SE 8 (oracle.com)](https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html)

- OS自分のJDKを検査

```
rpm -qa | grep java
```

- あるなら、下のように入力して消除し、複数のパッケージ存在のが並べて書き込む

```
rpm -e java-1.6.0-openjdk-1.6.0.41-1.13.13.1.el6_8.x86_64 tzdata-java-2016j-1.el6.noarch --nodeps
```

- 新しい目録を作成して、JDKパッケージをアップロードする

```
#専門の目録を作成
mkdir -p /opt/bigdata/servers

#JDKパッケージをアップロード
rz
```

![image-20240202163913649](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202163913649.png)

![image-20240202163953742](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202163953742.png)

```
#パッケージ解凍
tar -zxvf jdk-8u231-linux-x64.tar.gz

#元のパッケージを消除
rm jdk-8u231-linux-x64.tar.gz
```

![image-20240202165213111](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202165213111.png)

```
#環境変量ファイルを開く
vim /etc/profile

#「$PWD」命令は当のファイルアドレスを表せる
#最後に以下の内容を書き込み
export JAVA_HOME=/opt/bigdata/servers/jdk1.8.0_231
export PATH=:$JAVA_HOME/bin:$PATH
```

![image-20240202170129800](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202170129800.png)

```
#環境変量ファイルを有効にする
source /etc/profile

#インストールしたか検査
java -version
```

![image-20240202170519616](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202170519616.png)

　　単数のサービスの配置がここで終わり、次は複数のサービスのクラスタを作成や配置。

### 第４節　クラスタの環境整備

**クラスタの組立**

　　VMware工具を使って当のCentos1仮想マシンをクローンして、他の3つの仮想マシンを作成し、全て4つの仮想マシンを共にクラスタに組み立てておく。

![image-20240214210601298](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240214210601298.png)

![image-20240214210653650](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240214210653650.png)

![image-20240214210835798](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240214210835798.png)

- 独立、完全のクローン仮想マシンを作成

![image-20240214210857041](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240214210857041.png)

- 仮想マシンの名称やアドレスを添加

![image-20240214211142243](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240214211142243.png)

![image-20240214211321054](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240214211321054.png)

- クローン名流れが終わり、上記のように残りの2つ仮想マシンを作成

![image-20240214211649702](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240214211649702.png)

**ネットワーク配置**

　　残りの3つ仮想マシンを起動し、対応のサービスごとにネットワーク配置を改めて設定するが必要です。

- 固定IPアドレスを変更し、Centos2が136になる

```
vim /etc/sysconfig/network-scripts/ifcfg-ens33

#その一つを変更し、他の変数がそのままでいい
IPADDR=192.168.31.136
```

![image-20240219153551549](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240219153551549.png)　　

- 対応のサービスのhostnameを改修

```
vim /etc/sysconfig/network

hostname=centos02
```

![image-20240219160521398](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240219160521398.png)

```
#ネットワークを再起動
service network restart

#IPアドレスを検査
ip addr

#ネットワークが正常に働くかどうか確認
ping yahoo.com
```

![image-20240219160944353](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240219160944353.png)

　　他のCentos3、Centos4は次第に上記のように対応のIPアドレスなどの変更を行い、ここて重複の流れを省いてなる。

**パスワード不要の登録**

　　この部分は、SSH知識にかかわってあるが、深く了解していっては必要ない、せめて以後のビッグデータ学習に邪魔することがない。一言で言えば、SSH（Secure Shell）はサーバー間の通信の認証や暗号化など働きを提供し、安全性を保証できるの工具です。

　　SSHの通信方式は二つに分けて、パスワード認証や公開鍵認証である。

　　前者に主な使い場合はリモートサーバーに訪問する。例えば、SecureCRT工具がSSH方式によってリモートサーバーへ接続する選択肢がある。又は、コマンドライン画面に「ssh root@192.168.31.136」を入力して他のサーバに登録もそういうことです。

![image-20240223103515802](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240223103515802.png)

![image-20240223112407084](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240223112407084.png)

　　パスワード認証にのパスワードはCentOSのマウント流れにrootユーザーに対して設定されたのパスワードで、SSHを使うかどうか関係ない。つまり、SSHパスワード認証方式によって「パスワード不要の登録」効果に至らない。

　　次、後者の認証方式はSSH作成しての公開鍵や秘密鍵を一つの鍵ペアに組み合わせられるかどうかと判断する過程です。例えば、Centos1で鍵ペアが公開鍵や秘密鍵二つの部分に作成し、公開鍵を目標リモートシステムのあるファイルに書き込み、Centos1サーバーからコマンドやファイルとかを転送する時に自分の秘密鍵や相手に置いての公開鍵が一組にするかどうかからCentos1がそのサーバーに訪問の許可の有無があると判断してくれる。

　　その過程は身元証明書の確認みたい、来訪者の身元証明書が目標サーバーに預かった情報に適当したらアクセスを許可し、ユーザーやパスワードの入力が必要ない。そのために、クラスタの間に通信が効率と利便性を向上られ、特別に自動化で実行する必要があるタスクにとって不可欠です。次は、公開鍵認証の設定を始める。

- 全てのサーバーに目録を作成し、且つ目録に権限をあげる

```
mkdir /root/.ssh chmod 700 /root/.ssh
```

![image-20240220213108402](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240220213108402.png)

- 全てのサーバーに鍵ペアを作成

```
cd ~
ssh-keygen -t rsa -P "12345"
```

![image-20240227162456809](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240227162456809.png)

　　SSHパスワードを生成するコマンドで、-t引数は生成するアルゴリズムを示し、rsaとdsaの二種類があり、-P引数はパスワードを使用して鍵ペアの作成を補助する動きです。""（空の文字列）を書き込むとはパスワードなしの意味です。

- 残りの三つサーバーが上記のように扱う

![image-20240227165844497](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240227165844497.png)

![image-20240227165902681](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240227165902681.png)

![image-20240227165915527](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240227165915527.png)

- 一つのサーバー（centos1）について以下操作を行う

```
#.sshに入って
cd ~/.ssh

#id_rsa.pub中に内容をauthorized_keysファイルに書き込む
cat id_rsa.pub >> authorized_keys
```

![image-20240228160528149](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240228160528149.png)

　　vimコマンド実行してauthorized_keys内容を検査し、一段落の文字列が書き込まれた。それはcentos1サーバーの公開鍵です。

![image-20240228162052410](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240228162052410.png)

- authorized_keysファイルをcentos2サーバーに転送し、元のファイルを上書くのが構わない

```
scp authorized_keys centos2:/root/.ssh/

#又は以下の書き方、前提はコマンド入力の目録が目標サーバーへ転送の目録と同じです
scp authorized_keys centos2:$PWD
```

![image-20240228164051783](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240228164051783.png)

- centos2へ伝送するファイルが成功かどうか確認し

![image-20240228164027473](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240228164027473.png)

![image-20240228164002742](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240228164002742.png)

クラスタ環境でパスワードなしのログインを選択する主な理由は、効率と利便性を向上させるためです。パスワードなしのログインは、ユーザーがパスワードを入力することなく、安全にクラスタ内の他のノードにアクセスできるようにします。これは、自動化されたタスク、分散コンピューティング、メンテナンス操作を実行する際に特に有用であり、繰り返しパスワードを入力する必要を減らし、作業フローを加速します。

例えば、SSH（Secure Shell）を使ってリモートログインやコマンドを実行する際、パスワードなしのログインを設定することで、毎回ユーザーの身元を確認する必要がなくなります。これは特に大規模なクラスターを管理する際に重要であり、管理者は複数のサーバー間を頻繁に移動し、さまざまなメンテナンスや管理タスクを実行する必要があります。

また、パスワードなしのログインは、スクリプトやプログラムの無人運行を実現するのにも役立ちます。これは、自動化で実行する必要があるタスクにとって不可欠です。例えば、バックアッププロセス、ソフトウェアの展開と更新、その他の自動化プロセスは、パスワードなしのログインの設定から利益を得ることができます
