# ビッグデータ分散式クラスタの組立

### 第１節　仮想マシンのインストール

　　VMwareの選びは普通の完全版を使用していい。VMwareのインストールはネット上に色々説明がり、次の仮想マシンのインストールを紹介してから直接に始める。

- カスタマイズ選択肢を選ぶ

![image-20240126113207134](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126113207134.png)

![Screenshot 2024-01-26 114229](D:\OneDrive\picture\Typora\BigData\Preparatory Work\Screenshot 2024-01-26 114229-1706238162112-5.png)

- Workstation 15.x互換性の選択肢

![Screenshot 2024-01-26 114229](D:\OneDrive\picture\Typora\BigData\Preparatory Work\Screenshot 2024-01-26 114229-1706238275897-7.png)

- 仮想マシンを作成した後でLinuxインストール

![Screenshot 2024-01-26 114229](D:\OneDrive\picture\Typora\BigData\Preparatory Work\Screenshot 2024-01-26 114229-1706238733806-9.png)

![Screenshot](D:\OneDrive\picture\Typora\BigData\Preparatory Work\Screenshot.png)

- 仮想マシンを格納する目録

![image-20240126140039914](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140039914.png)

- 実際の状況に応じて変数を設定できるけれど、ビッグデータには高いプロセッサ性能が必要ため、できるだけ十分の資源を分配してあげる。特別ストレージ大小には20Gを勧めです。

![image-20240126140232359](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140232359.png)

![image-20240126140308237](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140308237.png)

- 黙認のままで「Next」を押す

![image-20240126140327310](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140327310.png)

![image-20240126140344591](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140344591.png)

![image-20240126140402517](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140402517.png)

![image-20240126140452789](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140452789.png)

- 20GBお勧めて、空間が足りないなら、事後追加するのがなかなか手がかかてある。

![image-20240126140530503](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140530503.png)

![image-20240126140551235](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140551235.png)

![image-20240126140609099](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140609099.png)

- ここで仮想マシンの作成が終わった

![image-20240126140637505](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126140637505.png)

### 第２節　CentosOSのマウント

　　Linux01仮想マシンの設定画面に入って、イメージファイルを選択する。OSのバージョンは「CentOS-7-x86_64-DVD-1810.iso」を選択し、互換性を考えて、Hadoop、HBase、Zoookeeperなどソフトウェアがそのバージョンにインストールするのが問題ないと確認した。できるだけこのバージョンを使用して、不明のエラーを避けられる。

ダウンロード：https://ftp.iij.ad.jp/pub/linux/centos-vault/7.6.1810/isos/x86_64/

![Screenshot](D:\OneDrive\picture\Typora\BigData\Preparatory Work\Screenshot-1706249684445-16.png)

- Liunⅹ01仮想マシンを起動し、第二の図で表れて「Install CentOS 7」を選択して入って、Centosのインストールを始める。

![image-20240126161602300](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126161602300.png)

![Screenshot](D:\OneDrive\picture\Typora\BigData\Preparatory Work\Screenshot-1706253527058-18.png)

![image-20240126162719940](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126162719940.png)

![image-20240126163035295](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126163035295.png)

- 自らの情況に応じて選択

![image-20240126163323888](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126163323888.png)

-  INSTALLATION DESTINATIONに入って

![image-20240126163350640](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126163350640.png)

- 自分で手動的にディスクを分配すると選択し、「Done」を押して次のディスク設定画面に遷移する

![image-20240126163536581](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126163536581.png)

![image-20240126163610725](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126163610725.png)

- 図にそってディスク仕切りを添加する。三つ部分で組み合い、根目録「/」にbootやswapを除いて残りの全て空間を分配して、特にストレージ大小を入力のが必要ないです。

![image-20240126163730584](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126163730584.png)

![image-20240126163828529](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126163828529.png)

![image-20240126163911593](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126163911593.png)

![image-20240126163952649](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126163952649.png)

- 図のように完成したら「Done」を押して変更一覧が表れる。「Accept Changes」ボタンを押す。

![image-20240126164014412](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126164014412.png)

![image-20240126164419211](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126164419211.png)

- OSのインストールを始める。

![image-20240126164459202](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126164459202.png)

- rootのパスワードを設定。

![image-20240126164614295](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126164614295.png)

![image-20240126164543421](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126164543421.png)

- rootユーザーを使用のが十分で、他の新ユーザーを作成しない。後は、若しboot分配大小が足りない、このインストール画面に限りで進められないという問題に遭ってある。

![image-20240126164811702](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126164811702.png)

- 「Reboot」ボタンを押して、OSを起動する流れに入っている。

![image-20240126165010923](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126165010923.png)

![image-20240126165150048](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126165150048.png)

![image-20240126165110305](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126165110305.png)

- rootユーザー名やパスワードを入力してOSシステムに入る。

![image-20240126165221456](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126165221456.png)

- 全て問題ないなら、ここでCentosOSのインストールが全部終わった。

![image-20240126165346427](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240126165346427.png)

### 第３節　OSの環境整備

#### ネットワーク配置

　　その前にVMwareのネットワーク設定を確認しておき、仮想マシンに勝手にIPアドレスを書き込むのが駄目です。

![image-20240130160644778](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240130160644778.png)

- 特別の変更点がない

![image-20240130161154110](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240130161154110.png)

- IPアドレスはGateway IP前の6位の値「192.168. 31」と一致にしなければならない。

![image-20240130161732554](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240130161732554.png)

- 最後の3位の数値は「128~254」範囲内に指定する。

![image-20240130161955350](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240130161955350.png)

**固定IPアドレス設定**

　　OSシステムに入って、今は外部からネットに連接できない。「ip addr」命令を入力して、IPアドレスに関する情報が欠けることが見える。従って、当面の任務は手動でシステム配置ファイルを改修し、正常にネットが通じることを動かしてある。

![image-20240201152647957](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201152647957.png)

　　VI編集工具を使って「ifcfg-ens33」ファイルを開く。VIの使用紹介はここで略する。

```
vi /etc/sysconfig/network-scripts/ifcfg-ens33
```

　　以下のように自分のネットワーク変数に即して改修を行う。

```
#改修の部分
BOOTPROTO=static
ONBOOT=yes
#添加の部分
#最後の三つ変数がVMwareネットワーク配置に一致を確保
IPADDR=192.168.31.135
NETMASK=255.255.255.0
GATEWAY=192.168.31.2
DNS1=192.168.31.2
```

![image-20240201142648288](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201142648288.png)

```
#ネットワークを再起動
service network restart

#ネットワークが通じるかどうか検査
ping yahoo.com
```

![image-20240201143410298](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201143410298.png)

　　改めてネットワーク設定を示して、新しいIPアドレス情報が書き込んだ。

![image-20240201142836164](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201142836164.png)

#### 基本環境設定

　　ネットワークを設定してIPアドレスを決めてから、外部からOSシステムに通信することができる。ここでSecureCRT工具を選んで、VMwareに代わってOSに訪問しておく。リモート訪問、ファイル転送、コーヒーなど操作がSecureCRTに中々便利である。以下はSecureCRTで登録の流れを表す。

![image-20240201191706532](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201191706532.png)

![image-20240201191737065](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201191737065.png)

![image-20240201191752496](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201191752496.png)

![image-20240201191822133](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201191822133.png)

![image-20240201192214227](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201192214227.png)

![image-20240201192234537](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240201192234537.png)

- 幾つか工具をインストール


```
#vim編集器
yum install vim

#アップロード工具
yum -y install lrzsz
```

![image-20240202070539835](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202070539835.png)

![image-20240202163237986](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202163237986.png)

```
yum -y install lrzsz
```

**firewall/selinux停止**

　　ビッグデータシステムは、一般的に企業内部に使用するものが存在し、専門的に外部訪問できるサービスを備えて一定の安全措置がある限り、クラスタ間に通信の安全性を考えることが少ない、必要ないエラーを避けるはずです。

```
#firewall停止
systemctl stop firewalld

#システムの起動時にfirewalldが自動的に起動しないようにする
systemctl disable firewalld

#firewall状態を検査
systemctl status firewalld
```

![image-20240202090106400](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202090106400.png)

```
#selinux配置ファイルにはいって
vim /etc/selinux/config

#「SELINUX=enforcing」を註釈になって、「SELINUX=disabled」を追加
SELINUX=disabled
```

![image-20240202102831883](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202102831883.png)

**仮想マシン名称やhostname**

　　その部分目的は仮想マシン名称、hostname、IPアドレスを統一になる。一つの明らかな名称をあげてどのサービスを直ぐに確定できる。

- 仮想マシン名称の改修

![image-20240202111139954](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202111139954.png)

- hostname改修

```
vim /etc/sysconfig/network

#以下内容を添加
NETWORKING=yes
hostname=linux135

#ネットワークを再起動
service network restart
```

![image-20240202115411824](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202115411824.png)

- hostnameやIPアドレスのマッピング添加

```
vim /etc/hosts

#以下の内容ように添加し、再起動は必要ない
192.168.31.135 linux135
192.168.31.136 linux136
192.168.31.137 linux137
```

![image-20240202151830198](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202151830198.png)

**JDKインストール**

　　ビッグデータはJavaの基準パッケージを引用することがあり、特別Hadoopシステムが元にJava言語で構成され、つまり、JDKが必ず備えておくものです。

JAVA8のダウンロードURL：[Java Archive Downloads - Java SE 8 (oracle.com)](https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html)

- OS自分のJDKを検査

```
rpm -qa | grep java
```

- あるなら、下のように入力して消除し、複数のパッケージ存在のが並べて書き込む

```
rpm -e java-1.6.0-openjdk-1.6.0.41-1.13.13.1.el6_8.x86_64 tzdata-java-2016j-1.el6.noarch --nodeps
```

- 新しい目録を作成して、JDKパッケージをアップロードする

```
#専門の目録を作成
mkdir -p /opt/bigdata/servers

#JDKパッケージをアップロード
rz
```

![image-20240202163913649](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202163913649.png)

![image-20240202163953742](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202163953742.png)

```
#パッケージ解凍
tar -zxvf jdk-8u231-linux-x64.tar.gz

#元のパッケージを消除
rm jdk-8u231-linux-x64.tar.gz
```

![image-20240202165213111](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202165213111.png)

```
#環境変量ファイルを開く
vim /etc/profile

#「$PWD」命令は当のファイルアドレスを表せる
#最後に以下の内容を書き込み
export JAVA_HOME=/opt/bigdata/servers/jdk1.8.0_231
export PATH=:$JAVA_HOME/bin:$PATH
```

![image-20240202170129800](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202170129800.png)

```
#環境変量ファイルを有効にする
source /etc/profile

#インストールしたか検査
java -version
```

![image-20240202170519616](D:\OneDrive\picture\Typora\BigData\Preparatory Work\image-20240202170519616.png)
